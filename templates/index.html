<!DOCTYPE html>
<html>
<head>
    <title>Quant Volatility Surface</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #111; color: #eee; margin: 0; padding: 20px; }
        #dashboard { display: flex; height: 90vh; }
        #plot-container { flex: 3; }
        #sidebar { flex: 1; padding-left: 20px; border-left: 1px solid #333; }
        .arb-alert { color: #ff4444; padding: 10px; background: #2a1111; border: 1px solid #ff4444; margin-bottom: 10px; border-radius: 4px; font-size: 12px; }
        h1 { margin-top: 0; font-size: 1.5rem; }
        .metric { font-size: 2rem; font-weight: bold; color: #00ff88; }
    </style>
</head>
<body>

    <div id="dashboard">
        <div id="plot-container"></div>

        <div id="sidebar">
            <h1>Volatility Surface</h1>
            <div style="margin-bottom: 20px;">
                <small>LIVE SPOT PRICE (SPX SIM)</small>
                <div id="spot-price" class="metric">Loading...</div>
            </div>

            <h3>Arbitrage Scanner</h3>
            <div id="arb-feed">
                </div>
        </div>
    </div>

    <script>
        var ws = new WebSocket("ws://" + location.host + "/ws");
        var plotDiv = document.getElementById('plot-container');

        var layout = {
            title: 'Implied Volatility Surface (Real-Time)',
            autosize: true,
            scene: {
                xaxis: {title: 'Strike Price', color: '#eee'},
                yaxis: {title: 'Days to Expiry', color: '#eee'},
                zaxis: {title: 'Implied Volatility', color: '#eee'},
                camera: { eye: {x: 1.5, y: 1.5, z: 1.2} }
            },
            paper_bgcolor: '#111',
            plot_bgcolor: '#111',
            font: { color: '#eee' },
            margin: {l: 0, r: 0, b: 0, t: 50}
        };

        ws.onmessage = function(event) {
            var data = JSON.parse(event.data);

            // Update Spot Price
            document.getElementById('spot-price').innerText = "$" + data.spot.toFixed(2);

            // Update Plot
            var trace = {
                x: data.x,
                y: data.y,
                z: data.z,
                type: 'mesh3d',
                intensity: data.z,
                colorscale: 'Viridis',
                opacity: 0.8
            };

            Plotly.react(plotDiv, [trace], layout);

            // Update Arb Feed
            var arbDiv = document.getElementById('arb-feed');
            arbDiv.innerHTML = ""; // Clear old
            if (data.arbs.length === 0) {
                arbDiv.innerHTML = "<div style='color:#666'>No anomalies detected.</div>";
            } else {
                data.arbs.forEach(arb => {
                    var div = document.createElement('div');
                    div.className = 'arb-alert';
                    div.innerHTML = `<b>${arb.type}</b><br>Strike: ${arb.strike}<br>${arb.details}`;
                    arbDiv.appendChild(div);
                });
            }
        };
    </script>
</body>
</html>